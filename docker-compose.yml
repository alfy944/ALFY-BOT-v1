services:
  n8n:
    image: n8nio/n8n
    container_name: n8n_workflow_engine
    restart: always
    ports:
      - "5678:5678"
    environment:
      - GENERIC_TIMEZONE=Europe/Rome
    volumes:
      - n8n_data:/home/node/.n8n
    networks:
      - trading-network

  technical-analyzer-agent:
    build: ./agents/01_technical_analyzer
    container_name: technical-analyzer-agent
    restart: always
    ports:
      - "8001:8000"
    networks:
      - trading-network

  news-sentiment-agent:
    build: ./agents/02_news_sentiment
    container_name: news-sentiment-agent
    restart: always
    ports:
      - "8002:8000"
    environment:
      - CRYPTOPANIC_API_KEY="a34f666b065e5f719d95b2eae0bd6e7a99cba69f"
    networks:
      - trading-network

  trade-guardian:
    build: ./agents/03_trade_guardian
    container_name: trade-guardian
    restart: always
    ports:
      - "8003:8000"
    networks:
      - trading-network

  bybit-executor:
    build: ./agents/04_bybit_executor
    container_name: bybit-executor
    restart: always
    ports:
      - "8004:8000"
    networks:
      - trading-network
  
  db:
    image: postgres:13-alpine
    container_name: trading_db
    restart: always
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=trading_db
    ports:
      - "5433:5432"
    volumes:
      - db_data:/var/lib/postgresql/data
    networks:
      - trading-network

  dashboard:
    build: ./dashboard
    container_name: dashboard_ui
    restart: always
    ports:
      - "8501:8501"
    networks:
      - trading-network

volumes:
  n8n_data:
  db_data:

networks:
  trading-network:
    driver: bridge